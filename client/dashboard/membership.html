<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knox Barbell - Membership</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/membership.css">
</head>

<body>
    <!-- sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h3>Knox Barbell</h3>
            <button class="toggle-btn" id="toggleSidebar">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <ul class="sidebar-menu">
            <li>
                <a href="/dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                    <div class="tooltip">Dashboard</div>
                </a>
            </li>
            <li>
                <a href="/members">
                    <i class="fas fa-user"></i>
                    <span>Member</span>
                    <div class="tooltip">Member</div>
                </a>
            </li>
            <li>
                <a href="/application">
                    <i class="fa-solid fa-file-lines"></i>
                    <span>Application</span>
                    <div class="tooltip">Application</div>
                </a>
            </li>
            <li>
                <a href="/membership" class="active">
                    <i class="fas fa-id-card"></i>
                    <span>Membership</span>
                    <div class="tooltip">Membership</div>
                </a>
            </li>
            <li>
                <a href="/trainers">
                    <i class="fas fa-chalkboard-teacher"></i>
                    <span>Trainers</span>
                    <div class="tooltip">Trainers</div>
                </a>
            </li>
            <li>
                <a href="/employee">
                    <i class="fas fa-users"></i>
                    <span>Employee</span>
                    <div class="tooltip">Employee</div>
                </a>
            </li>
            <li>
                <a href="/notifications">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                    <div class="tooltip">Notifications</div>
                </a>
            </li>
            <li>
                <a href="/attendance">
                    <i class="fas fa-calendar-check"></i>
                    <span>Attendance</span>
                    <div class="tooltip">Attendance</div>
                </a>
            </li>
            <li>
                <a href="/events">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Events</span>
                    <div class="tooltip">Events</div>
                </a>
            </li>
            <li>
                <a href="/finance">
                    <i class="fas fa-wallet"></i>
                    <span>Finance</span>
                    <div class="tooltip">Finance</div>
                </a>
            </li>
            <li>
                <a href="/locker">
                    <i class="fas fa-lock"></i>
                    <span>Locker</span>
                    <div class="tooltip">Locker</div>
                </a>
            </li>
            <li>
                <a href="/product">
                  <i class="fas fa-box"></i>
                  <span>Product</span>
                  <div class="tooltip">Product</div>
                </a>
              </li>
            <li class="logout-item">
                <a href="#" id="logoutButton">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                    <div class="tooltip">Logout</div>
                </a>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Topbar -->
        <div class="topbar">
            <div class="topbar-left">
                <button class="mobile-toggle" id="mobileToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h3>Membership</h3>
            </div>
            <div class="topbar-right">
                <!-- notification  -->
                <div class="notification">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">0</span>
                    
                    <!-- Notification Modal -->
                    <div class="notification-modal">
                        <div class="notification-header">
                            <h3>Notifications</h3>
                            <div class="notification-actions">
                                <a href="/notifications" class="view-all-link">View All</a>
                                <button class="close-notifications">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="notification-list">
                            <!-- Notifications will be populated here -->
                            <div class="notification-loading">
                                <i class="fas fa-spinner fa-spin"></i> Loading notifications...
                            </div>
                        </div>
                    </div>
                </div>
                <div class="user-greeting">
                    <img src="/img/Knox Logo-01.png" alt="User">
                    <span>Hello, Knox Barbell</span>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="content">
            <div class="content-header">
                <h1>Membership Management</h1>
                <button id="addMembershipBtn">
                    <span>+</span>
                    <p>Add</p>
                </button>
            </div>

            <!-- Loading state for membership cards -->
            <div id="membershipCardsLoading" class="membership-cards">
                <div class="loading-card">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading memberships...</p>
                </div>
            </div>

            <!-- Dynamic membership cards will be populated here -->
            <div id="membershipCards" class="membership-cards" style="display: none;">
                <!-- Membership cards will be dynamically generated here -->
            </div>

            <!-- Enrolled Members Table -->
            <div class="table-container">
                <div class="table-header">
                    <h2>Membership Statistics</h2>
                </div>
                <table class="enrolled-table">
                    <thead>
                        <tr>
                            <th>S.N</th>
                            <th>Membership Type</th>
                            <th>Created at</th>
                            <th>Price</th>
                            <th>Duration</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="membershipTableBody">
                        <tr>
                            <td colspan="6" class="loading-row">
                                <i class="fas fa-spinner fa-spin"></i> Loading memberships...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add Membership Modal -->
    <div id="addMembershipModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Membership</h2>
            </div>
            <form id="addMembershipForm" class="modal-body">
                <div class="form-container-membership">
                <div class="column">
                    <label for="membershipTitle">Membership Title</label>
                    <input type="text" id="membershipTitle" name="title" required placeholder="e.g., Silver, Gold, Platinum">
                    <label for="membershipPrice">Price (Rs)</label>
                    <input type="number" id="membershipPrice" name="price" required min="0" placeholder="e.g., 4000">
                    <label for="membershipDuration">Duration</label>
                    <input type="text" id="membershipDuration" name="duration" required placeholder="e.g., 1 Month, 3 Months">
                    <label>Card Background</label>
                    <div class="color-type-selector">
                        <label class="radio-label">
                            <input type="radio" name="colorType" value="simple" checked>
                            <span>Simple</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="colorType" value="gradient">
                            <span>Gradient</span>
                        </label>
                    </div>
                </div>
                <div class="column">
                    <div class="color-customization">
                        <div id="simpleColorSection" class="color-section">
                            <label for="simpleColor">Background Color</label>
                            <div class="color-input-group">
                                <input type="color" id="simpleColor" name="simpleColor" value="#3498db">
                                <input type="text" id="simpleColorText" placeholder="#3498db" pattern="^#[0-9A-Fa-f]{6}$">
                            </div>
                        </div>
                        
                        <div id="gradientColorSection" class="color-section" style="display: none;">
                            <div class="gradient-inputs">
                                <div class="gradient-input">
                                    <label for="gradientColor1">Color 1</label>
                                    <div class="color-input-group">
                                        <input type="color" id="gradientColor1" name="gradientColor1" value="#3498db">
                                        <input type="text" id="gradientColor1Text" placeholder="#3498db" pattern="^#[0-9A-Fa-f]{6}$">
                                    </div>
                                </div>
                                <div class="gradient-input">
                                    <label for="gradientColor2">Color 2</label>
                                    <div class="color-input-group">
                                        <input type="color" id="gradientColor2" name="gradientColor2" value="#2980b9">
                                        <input type="text" id="gradientColor2Text" placeholder="#2980b9" pattern="^#[0-9A-Fa-f]{6}$">
                                    </div>
                                </div>
                            </div>
                            <div class="gradient-direction">
                                <label for="gradientDirection">Direction</label>
                                <select id="gradientDirection" name="gradientDirection">
                                    <option value="to right">Horizontal</option>
                                    <option value="to bottom">Vertical</option>
                                    <option value="135deg">Diagonal</option>
                                    <option value="45deg">Diagonal Reverse</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="color-preview">
                            <label>Preview</label>
                            <div id="colorPreview" class="preview-card">
                                <div class="preview-content">
                                    <h3>Sample Title</h3>
                                    <p>Rs 5000</p>
                                    <span>1 Month</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-actions row">
                    <button type="button" class="btn btn-secondary" id="cancelAddMembership">Cancel</button>
                    <button type="submit" class="btn">Add Membership</button>
                </div>
            </div>
                
            </form>
        </div>
    </div>

    <!-- Edit Membership Modal -->
    <div id="editMembershipModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Membership</h2>
                <button class="close-modal" id="closeEditModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="editMembershipForm" class="modal-body">
                <input type="hidden" id="editMembershipId" name="id">
                <div class="form-group">
                    <label for="editMembershipTitle">Membership Title</label>
                    <input type="text" id="editMembershipTitle" name="title" required>
                </div>
                <div class="form-group">
                    <label for="editMembershipPrice">Price (Rs)</label>
                    <input type="number" id="editMembershipPrice" name="price" required min="0">
                </div>
                <div class="form-group">
                    <label for="editMembershipDuration">Duration</label>
                    <input type="text" id="editMembershipDuration" name="duration" required>
                </div>
                <div class="form-group">
                    <label>Card Background</label>
                    <div class="color-customization">
                        <div class="color-type-selector">
                            <label class="radio-label">
                                <input type="radio" name="editColorType" value="simple" checked>
                                <span>Simple Color</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="editColorType" value="gradient">
                                <span>Gradient</span>
                            </label>
                        </div>
                        
                        <div id="editSimpleColorSection" class="color-section">
                            <label for="editSimpleColor">Background Color</label>
                            <div class="color-input-group">
                                <input type="color" id="editSimpleColor" name="simpleColor" value="#3498db">
                                <input type="text" id="editSimpleColorText" placeholder="#3498db" pattern="^#[0-9A-Fa-f]{6}$">
                            </div>
                        </div>
                        
                        <div id="editGradientColorSection" class="color-section" style="display: none;">
                            <div class="gradient-inputs">
                                <div class="gradient-input">
                                    <label for="editGradientColor1">Color 1</label>
                                    <div class="color-input-group">
                                        <input type="color" id="editGradientColor1" name="gradientColor1" value="#3498db">
                                        <input type="text" id="editGradientColor1Text" placeholder="#3498db" pattern="^#[0-9A-Fa-f]{6}$">
                                    </div>
                                </div>
                                <div class="gradient-input">
                                    <label for="editGradientColor2">Color 2</label>
                                    <div class="color-input-group">
                                        <input type="color" id="editGradientColor2" name="gradientColor2" value="#2980b9">
                                        <input type="text" id="editGradientColor2Text" placeholder="#2980b9" pattern="^#[0-9A-Fa-f]{6}$">
                                    </div>
                                </div>
                            </div>
                            <div class="gradient-direction">
                                <label for="editGradientDirection">Direction</label>
                                <select id="editGradientDirection" name="gradientDirection">
                                    <option value="to right">Horizontal</option>
                                    <option value="to bottom">Vertical</option>
                                    <option value="135deg">Diagonal</option>
                                    <option value="45deg">Diagonal Reverse</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="color-preview">
                            <label>Preview</label>
                            <div id="editColorPreview" class="preview-card">
                                <div class="preview-content">
                                    <h3>Sample Title</h3>
                                    <p>Rs 5000</p>
                                    <span>1 Month</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelEditMembership">Cancel</button>
                    <button type="submit" class="btn">Update Membership</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/js/main.js"></script>
    <script src="./js/logout.js"></script>
    <script>
        // Global variables
        let memberships = [];
        let currentEditingId = null;

        // DOM elements
        const addMembershipBtn = document.getElementById('addMembershipBtn');
        const addMembershipModal = document.getElementById('addMembershipModal');
        const cancelAddMembership = document.getElementById('cancelAddMembership');
        const addMembershipForm = document.getElementById('addMembershipForm');

        const editMembershipModal = document.getElementById('editMembershipModal');
        const closeEditModal = document.getElementById('closeEditModal');
        const cancelEditMembership = document.getElementById('cancelEditMembership');
        const editMembershipForm = document.getElementById('editMembershipForm');

        const membershipCards = document.getElementById('membershipCards');
        const membershipCardsLoading = document.getElementById('membershipCardsLoading');
        const membershipTableBody = document.getElementById('membershipTableBody');

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadMemberships();
            setupEventListeners();
            setupNotificationSystem();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Add membership modal
            addMembershipBtn.addEventListener('click', () => {
                addMembershipModal.classList.add('active');
            });

            cancelAddMembership.addEventListener('click', () => {
                addMembershipModal.classList.remove('active');
                addMembershipForm.reset();
            });

            // Edit membership modal
            closeEditModal.addEventListener('click', () => {
                editMembershipModal.classList.remove('active');
                editMembershipForm.reset();
            });

            cancelEditMembership.addEventListener('click', () => {
                editMembershipModal.classList.remove('active');
                editMembershipForm.reset();
            });

            // Form submissions
            addMembershipForm.addEventListener('submit', handleAddMembership);
            editMembershipForm.addEventListener('submit', handleEditMembership);

            // Close modals when clicking outside
            addMembershipModal.addEventListener('click', (e) => {
                if (e.target === addMembershipModal) {
                    addMembershipModal.classList.remove('active');
                    addMembershipForm.reset();
                }
            });

            editMembershipModal.addEventListener('click', (e) => {
                if (e.target === editMembershipModal) {
                    editMembershipModal.classList.remove('active');
                    editMembershipForm.reset();
                }
            });

            // Color customization event listeners
            setupColorCustomization();
        }

        // Setup color customization functionality
        function setupColorCustomization() {
            // Add membership form color controls
            const colorTypeRadios = document.querySelectorAll('input[name="colorType"]');
            const simpleColorSection = document.getElementById('simpleColorSection');
            const gradientColorSection = document.getElementById('gradientColorSection');
            
            colorTypeRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    if (e.target.value === 'simple') {
                        simpleColorSection.style.display = 'block';
                        gradientColorSection.style.display = 'none';
                    } else {
                        simpleColorSection.style.display = 'none';
                        gradientColorSection.style.display = 'block';
                    }
                    updateColorPreview('add');
                });
            });

            // Edit membership form color controls
            const editColorTypeRadios = document.querySelectorAll('input[name="editColorType"]');
            const editSimpleColorSection = document.getElementById('editSimpleColorSection');
            const editGradientColorSection = document.getElementById('editGradientColorSection');
            
            editColorTypeRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    if (e.target.value === 'simple') {
                        editSimpleColorSection.style.display = 'block';
                        editGradientColorSection.style.display = 'none';
                    } else {
                        editSimpleColorSection.style.display = 'none';
                        editGradientColorSection.style.display = 'block';
                    }
                    updateColorPreview('edit');
                });
            });

            // Color input event listeners for add form
            const addColorInputs = [
                'simpleColor', 'simpleColorText', 'gradientColor1', 'gradientColor1Text',
                'gradientColor2', 'gradientColor2Text', 'gradientDirection'
            ];
            
            addColorInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', () => updateColorPreview('add'));
                    element.addEventListener('change', () => updateColorPreview('add'));
                }
            });

            // Color input event listeners for edit form
            const editColorInputs = [
                'editSimpleColor', 'editSimpleColorText', 'editGradientColor1', 'editGradientColor1Text',
                'editGradientColor2', 'editGradientColor2Text', 'editGradientDirection'
            ];
            
            editColorInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', () => updateColorPreview('edit'));
                    element.addEventListener('change', () => updateColorPreview('edit'));
                }
            });

            // Sync color picker with text input
            syncColorInputs();
        }

        // Sync color picker inputs with text inputs
        function syncColorInputs() {
            // Add form sync
            const simpleColor = document.getElementById('simpleColor');
            const simpleColorText = document.getElementById('simpleColorText');
            const gradientColor1 = document.getElementById('gradientColor1');
            const gradientColor1Text = document.getElementById('gradientColor1Text');
            const gradientColor2 = document.getElementById('gradientColor2');
            const gradientColor2Text = document.getElementById('gradientColor2Text');

            // Edit form sync
            const editSimpleColor = document.getElementById('editSimpleColor');
            const editSimpleColorText = document.getElementById('editSimpleColorText');
            const editGradientColor1 = document.getElementById('editGradientColor1');
            const editGradientColor1Text = document.getElementById('editGradientColor1Text');
            const editGradientColor2 = document.getElementById('editGradientColor2');
            const editGradientColor2Text = document.getElementById('editGradientColor2Text');

            // Add form listeners
            simpleColor.addEventListener('input', () => {
                simpleColorText.value = simpleColor.value;
                updateColorPreview('add');
            });
            simpleColorText.addEventListener('input', () => {
                if (simpleColorText.value.match(/^#[0-9A-Fa-f]{6}$/)) {
                    simpleColor.value = simpleColorText.value;
                    updateColorPreview('add');
                }
            });

            gradientColor1.addEventListener('input', () => {
                gradientColor1Text.value = gradientColor1.value;
                updateColorPreview('add');
            });
            gradientColor1Text.addEventListener('input', () => {
                if (gradientColor1Text.value.match(/^#[0-9A-Fa-f]{6}$/)) {
                    gradientColor1.value = gradientColor1Text.value;
                    updateColorPreview('add');
                }
            });

            gradientColor2.addEventListener('input', () => {
                gradientColor2Text.value = gradientColor2.value;
                updateColorPreview('add');
            });
            gradientColor2Text.addEventListener('input', () => {
                if (gradientColor2Text.value.match(/^#[0-9A-Fa-f]{6}$/)) {
                    gradientColor2.value = gradientColor2Text.value;
                    updateColorPreview('add');
                }
            });

            // Edit form listeners
            editSimpleColor.addEventListener('input', () => {
                editSimpleColorText.value = editSimpleColor.value;
                updateColorPreview('edit');
            });
            editSimpleColorText.addEventListener('input', () => {
                if (editSimpleColorText.value.match(/^#[0-9A-Fa-f]{6}$/)) {
                    editSimpleColor.value = editSimpleColorText.value;
                    updateColorPreview('edit');
                }
            });

            editGradientColor1.addEventListener('input', () => {
                editGradientColor1Text.value = editGradientColor1.value;
                updateColorPreview('edit');
            });
            editGradientColor1Text.addEventListener('input', () => {
                if (editGradientColor1Text.value.match(/^#[0-9A-Fa-f]{6}$/)) {
                    editGradientColor1.value = editGradientColor1Text.value;
                    updateColorPreview('edit');
                }
            });

            editGradientColor2.addEventListener('input', () => {
                editGradientColor2Text.value = editGradientColor2.value;
                updateColorPreview('edit');
            });
            editGradientColor2Text.addEventListener('input', () => {
                if (editGradientColor2Text.value.match(/^#[0-9A-Fa-f]{6}$/)) {
                    editGradientColor2.value = editGradientColor2Text.value;
                    updateColorPreview('edit');
                }
            });
        }

        // Update color preview
        function updateColorPreview(formType) {
            const previewElement = document.getElementById(formType === 'add' ? 'colorPreview' : 'editColorPreview');
            const colorType = document.querySelector(`input[name="${formType === 'add' ? 'colorType' : 'editColorType'}"]:checked`).value;
            
            let backgroundStyle = '';
            
            if (colorType === 'simple') {
                const color = document.getElementById(formType === 'add' ? 'simpleColor' : 'editSimpleColor').value;
                backgroundStyle = color;
            } else {
                const color1 = document.getElementById(formType === 'add' ? 'gradientColor1' : 'editGradientColor1').value;
                const color2 = document.getElementById(formType === 'add' ? 'gradientColor2' : 'editGradientColor2').value;
                const direction = document.getElementById(formType === 'add' ? 'gradientDirection' : 'editGradientDirection').value;
                backgroundStyle = `linear-gradient(${direction}, ${color1}, ${color2})`;
            }
            
            previewElement.style.background = backgroundStyle;
        }

        // Get color data from form
        function getColorData(formType) {
            const colorType = document.querySelector(`input[name="${formType === 'add' ? 'colorType' : 'editColorType'}"]:checked`).value;
            
            if (colorType === 'simple') {
                const color = document.getElementById(formType === 'add' ? 'simpleColor' : 'editSimpleColor').value;
                return {
                    type: 'simple',
                    color: color
                };
            } else {
                const color1 = document.getElementById(formType === 'add' ? 'gradientColor1' : 'editGradientColor1').value;
                const color2 = document.getElementById(formType === 'add' ? 'gradientColor2' : 'editGradientColor2').value;
                const direction = document.getElementById(formType === 'add' ? 'gradientDirection' : 'editGradientDirection').value;
                return {
                    type: 'gradient',
                    color1: color1,
                    color2: color2,
                    direction: direction
                };
            }
        }

        // Apply color to membership card
        function applyColorToCard(cardElement, colorData) {
            if (!colorData) return;
            
            if (colorData.type === 'simple') {
                cardElement.style.background = colorData.color;
            } else if (colorData.type === 'gradient') {
                cardElement.style.background = `linear-gradient(${colorData.direction}, ${colorData.color1}, ${colorData.color2})`;
            }
        }

        // Load memberships from API
        async function loadMemberships() {
            try {
                const response = await fetch(`${baseUrl}/api/memberships`, {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success) {
                    memberships = data.data;
                    renderMembershipCards();
                    renderMembershipTable();
                } else {
                    throw new Error(data.message || 'Failed to load memberships');
                }
            } catch (error) {
                console.error('Error loading memberships:', error);
                showError('Failed to load memberships');
            }
        }

        // Render membership cards
        function renderMembershipCards() {
            if (memberships.length === 0) {
                membershipCards.innerHTML = `
                    <div class="no-memberships">
                        <i class="fas fa-id-card"></i>
                        <p>No memberships found</p>
                        <button class="btn" onclick="addMembershipModal.classList.add('active')">
                            Add First Membership
                        </button>
                    </div>
                `;
            } else {
                membershipCards.innerHTML = memberships.map((membership, index) => {
                    // Create card element
                    const cardElement = document.createElement('div');
                    cardElement.className = 'membership-card';
                    
                    // Apply custom color if available, otherwise use default class
                    if (membership.colorData) {
                        applyColorToCard(cardElement, membership.colorData);
                    } else {
                        cardElement.classList.add(getMembershipClass(membership.title));
                    }
                    
                    cardElement.innerHTML = `
                        <h2>${membership.title}</h2>
                        <h3 class="rate">Rs ${membership.price.toLocaleString()}</h3>
                        <h6 class="duration">Duration: ${membership.duration}</h6>
                        <div class="membership-actions">
                            <button class="edit-btn" onclick="editMembership('${membership._id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="delete-btn" onclick="deleteMembership('${membership._id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    return cardElement.outerHTML;
                }).join('');
            }

            // Hide loading and show cards
            membershipCardsLoading.style.display = 'none';
            membershipCards.style.display = 'grid';
        }

        // Render membership table
        function renderMembershipTable() {
            if (memberships.length === 0) {
                membershipTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="no-data">
                            <i class="fas fa-inbox"></i>
                            <p>No memberships available</p>
                        </td>
                    </tr>
                `;
            } else {
                membershipTableBody.innerHTML = memberships.map((membership, index) => `
                    <tr>
                        <td>${index + 1}</td>
                        <td>
                            <span class="membership-badge badge-${getMembershipClass(membership.title)}">
                                ${membership.title}
                            </span>
                        </td>
                        <td>${new Date(membership.createdAt).toLocaleDateString()}</td>
                        <td>Rs ${membership.price.toLocaleString()}</td>
                        <td>${membership.duration}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="edit-btn" onclick="editMembership('${membership._id}')" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="delete-btn" onclick="deleteMembership('${membership._id}')" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Get membership class for styling
        function getMembershipClass(title) {
            const titleLower = title.toLowerCase();
            if (titleLower.includes('silver')) return 'silver';
            if (titleLower.includes('gold')) return 'gold';
            if (titleLower.includes('diamond')) return 'diamond';
            if (titleLower.includes('platinum')) return 'platinum';
            return 'silver'; // default
        }

        // Handle add membership
        async function handleAddMembership(e) {
            e.preventDefault();
            
            const formData = new FormData(addMembershipForm);
            const membershipData = {
                title: formData.get('title'),
                price: parseFloat(formData.get('price')),
                duration: formData.get('duration'),
                colorData: getColorData('add')
            };

            try {
                const response = await fetch(`${baseUrl}/api/memberships`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify(membershipData)
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess('Membership added successfully');
                    addMembershipModal.classList.remove('active');
                    addMembershipForm.reset();
                    await loadMemberships();
                } else {
                    throw new Error(data.message || 'Failed to add membership');
                }
            } catch (error) {
                console.error('Error adding membership:', error);
                showError(error.message || 'Failed to add membership');
            }
        }

        // Handle edit membership
        async function handleEditMembership(e) {
            e.preventDefault();
            
            const formData = new FormData(editMembershipForm);
            const membershipData = {
                title: formData.get('title'),
                price: parseFloat(formData.get('price')),
                duration: formData.get('duration'),
                colorData: getColorData('edit')
            };

            try {
                const response = await fetch(`${baseUrl}/api/memberships/${currentEditingId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify(membershipData)
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess('Membership updated successfully');
                    editMembershipModal.classList.remove('active');
                    editMembershipForm.reset();
                    currentEditingId = null;
                    await loadMemberships();
                } else {
                    throw new Error(data.message || 'Failed to update membership');
                }
            } catch (error) {
                console.error('Error updating membership:', error);
                showError(error.message || 'Failed to update membership');
            }
        }

        // Edit membership function
        function editMembership(id) {
            const membership = memberships.find(m => m._id === id);
            if (!membership) return;

            currentEditingId = id;
            document.getElementById('editMembershipId').value = id;
            document.getElementById('editMembershipTitle').value = membership.title;
            document.getElementById('editMembershipPrice').value = membership.price;
            document.getElementById('editMembershipDuration').value = membership.duration;

            // Set color data
            if (membership.colorData) {
                if (membership.colorData.type === 'simple') {
                    document.querySelector('input[name="editColorType"][value="simple"]').checked = true;
                    document.getElementById('editSimpleColor').value = membership.colorData.color;
                    document.getElementById('editSimpleColorText').value = membership.colorData.color;
                    document.getElementById('editSimpleColorSection').style.display = 'block';
                    document.getElementById('editGradientColorSection').style.display = 'none';
                } else if (membership.colorData.type === 'gradient') {
                    document.querySelector('input[name="editColorType"][value="gradient"]').checked = true;
                    document.getElementById('editGradientColor1').value = membership.colorData.color1;
                    document.getElementById('editGradientColor1Text').value = membership.colorData.color1;
                    document.getElementById('editGradientColor2').value = membership.colorData.color2;
                    document.getElementById('editGradientColor2Text').value = membership.colorData.color2;
                    document.getElementById('editGradientDirection').value = membership.colorData.direction;
                    document.getElementById('editSimpleColorSection').style.display = 'none';
                    document.getElementById('editGradientColorSection').style.display = 'block';
                }
                updateColorPreview('edit');
            }

            editMembershipModal.classList.add('active');
        }

        // Delete membership function
        async function deleteMembership(id) {
            const confirmed = await window.confirmDialog({
                title: 'Delete Membership',
                message: 'Are you sure you want to delete this membership? This action cannot be undone.',
                type: 'delete'
            });

            if (!confirmed) return;

            try {
                const response = await fetch(`${baseUrl}/api/memberships/${id}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess('Membership deleted successfully');
                    await loadMemberships();
                } else {
                    throw new Error(data.message || 'Failed to delete membership');
                }
            } catch (error) {
                console.error('Error deleting membership:', error);
                showError(error.message || 'Failed to delete membership');
            }
        }

        // Show success message
        function showSuccess(message) {
            if (typeof window.toast === 'function') {
                window.toast(message, 'success');
            } else {
                alert(message);
            }
        }

        // Show error message
        function showError(message) {
            if (typeof window.toast === 'function') {
                window.toast(message, 'error');
            } else {
                alert(message);
            }
        }

        // Setup notification system
        function setupNotificationSystem() {
            const notificationIcon = document.querySelector('.notification');
            const notificationModal = document.querySelector('.notification-modal');
            const closeNotifications = document.querySelector('.close-notifications');
            const notificationList = document.querySelector('.notification-list');
            const notificationBadge = document.querySelector('.notification-badge');

            // Toggle notification modal
            notificationIcon.addEventListener('click', function(e) {
                e.stopPropagation();
                notificationModal.classList.toggle('active');
                if (notificationModal.classList.contains('active')) {
                    fetchNotifications();
                }
            });

            // Close notification modal
            closeNotifications.addEventListener('click', function(e) {
                e.stopPropagation();
                notificationModal.classList.remove('active');
            });

            // Close modal when clicking outside
            document.addEventListener('click', function(e) {
                if (!notificationModal.contains(e.target) && !notificationIcon.contains(e.target)) {
                    notificationModal.classList.remove('active');
                }
            });

            // Fetch unread count
            async function fetchUnreadCount() {
                try {
                    const response = await fetch(`${baseUrl}/api/notifications/unread-count`);
                    const data = await response.json();
                    if (data.success) {
                        notificationBadge.textContent = data.data.unreadCount;
                        notificationBadge.style.display = data.data.unreadCount > 0 ? 'flex' : 'none';
                    }
                } catch (error) {
                    console.error('Error fetching unread count:', error);
                }
            }

            // Fetch notifications from API
            async function fetchNotifications() {
                try {
                    notificationList.innerHTML = `
                        <div class="notification-loading">
                            <i class="fas fa-spinner fa-spin"></i> Loading notifications...
                        </div>
                    `;

                    const response = await fetch(`${baseUrl}/api/notifications`);
                    const data = await response.json();

                    if (data.success) {
                        const notifications = data.data;
                        
                        if (notifications.length === 0) {
                            notificationList.innerHTML = `
                                <div class="notification-empty">
                                    <i class="fas fa-bell-slash"></i>
                                    <p>No new notifications</p>
                                </div>
                            `;
                            return;
                        }

                        notificationList.innerHTML = notifications.map(notif => `
                            <div class="notification-item ${notif.status === 'unread' ? 'unread' : ''}" 
                                 data-notification-id="${notif._id}">
                                <div class="notification-title">
                                    ${notif.title}
                                    ${notif.status === 'unread' ? '<span class="unread-dot"></span>' : ''}
                                </div>
                                <div class="notification-message">${notif.message}</div>
                                <div class="notification-time">${new Date(notif.createdAt).toLocaleString()}</div>
                            </div>
                        `).join('');

                        const notificationItems = document.querySelectorAll('.notification-item');
                        notificationItems.forEach(item => {
                            item.addEventListener('click', async () => {
                                const notificationId = item.dataset.notificationId;
                                if (item.classList.contains('unread')) {
                                    try {
                                        const response = await fetch(`${baseUrl}/api/notifications/${notificationId}/read`, {
                                            method: 'PATCH',
                                            credentials: 'include'
                                        });
                                        
                                        if (response.ok) {
                                            item.classList.remove('unread');
                                            const unreadDot = item.querySelector('.unread-dot');
                                            if (unreadDot) unreadDot.remove();
                                            await fetchUnreadCount();
                                        }
                                    } catch (error) {
                                        console.error('Error marking notification as read:', error);
                                    }
                                }

                                notificationModal.classList.remove('active');
                                window.location.href = '/application';
                            });
                        });
                    } else {
                        throw new Error(data.message || 'Failed to fetch notifications');
                    }
                } catch (error) {
                    console.error('Error fetching notifications:', error);
                    notificationList.innerHTML = `
                        <div class="notification-empty">
                            <i class="fas fa-exclamation-circle"></i>
                            <p>Failed to load notifications</p>
                        </div>
                    `;
                }
            }

            fetchNotifications();
            fetchUnreadCount();
            setInterval(fetchUnreadCount, 30000);
        }
    </script>
</body>

</html>